@using FlowManager.Shared.DTOs
@using System.Net.Http.Json

@if (isLoading)
{
    <div class="loading-container">
        <div class="spinner"></div>
        <p>Loading user details...</p>
    </div>
}
else if (!string.IsNullOrEmpty(errorMessage))
{
    <div class="error-container">
        <div class="error-message">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="error-icon">
                <path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z" clip-rule="evenodd" />
            </svg>
            @errorMessage
        </div>
        <button @onclick="RefreshData" class="retry-button">Try Again</button>
    </div>
}
else if (userProfile != null)
{
    <div class="user-details-container">
        <!-- Header with refresh button -->
        <div class="details-header">
            <h3>My Details</h3>
            <button @onclick="RefreshData" class="refresh-button">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="refresh-icon">
                    <path fill-rule="evenodd" d="M4.755 10.059a7.5 7.5 0 0112.548-3.364l1.903 1.903h-3.183a.75.75 0 000 1.5h4.992a.75.75 0 00.75-.75V4.356a.75.75 0 00-1.5 0v3.18l-1.9-1.9A9 9 0 003.306 9.67a.75.75 0 101.45.388zm15.408 3.352a.75.75 0 00-.919.53 7.5 7.5 0 01-12.548 3.364l-1.902-1.903h3.183a.75.75 0 000-1.5H2.984a.75.75 0 00-.75.75v4.992a.75.75 0 001.5 0v-3.18l1.9 1.9a9 9 0 0015.059-4.035.75.75 0 00-.53-.918z" clip-rule="evenodd" />
                </svg>
                Refresh
            </button>
        </div>

        <!-- User Information Cards -->
        <div class="details-grid">
            <!-- Personal Information Card -->
            <div class="detail-card">
                <div class="card-header">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="card-icon">
                        <path fill-rule="evenodd" d="M7.5 6a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM3.751 20.105a8.25 8.25 0 0116.498 0 .75.75 0 01-.437.695A18.683 18.683 0 0112 22.5c-2.786 0-5.433-.608-7.812-1.7a.75.75 0 01-.437-.695z" clip-rule="evenodd" />
                    </svg>
                    <h4>Personal Information</h4>
                </div>
                <div class="card-content">
                    <div class="detail-row">
                        <span class="detail-label">Full Name:</span>
                        <span class="detail-value">@userProfile.Name</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Username:</span>
                        <span class="detail-value">@userProfile.UserName</span>
                    </div>
                </div>
            </div>

            <!-- Contact Information Card -->
            <div class="detail-card">
                <div class="card-header">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="card-icon">
                        <path d="M1.5 8.67v8.58a3 3 0 003 3h15a3 3 0 003-3V8.67l-8.928 5.493a3 3 0 01-3.144 0L1.5 8.67z" />
                        <path d="M22.5 6.908V6.75a3 3 0 00-3-3h-15a3 3 0 00-3 3v.158l9.714 5.978a1.5 1.5 0 001.572 0L22.5 6.908z" />
                    </svg>
                    <h4>Contact Information</h4>
                </div>
                <div class="card-content">
                    <div class="detail-row">
                        <span class="detail-label">Email Address:</span>
                        <span class="detail-value">@userProfile.Email</span>
                    </div>
                </div>
            </div>

            <!-- Roles & Permissions Card -->
            <div class="detail-card">
                <div class="card-header">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="card-icon">
                        <path fill-rule="evenodd" d="M12.516 2.17a.75.75 0 00-1.032 0 11.209 11.209 0 01-7.877 3.08.75.75 0 00-.722.515A12.74 12.74 0 002.25 9.75c0 5.814 3.926 10.732 9.317 12.096a.75.75 0 00.866 0C18.824 20.482 22.75 15.564 22.75 9.75c0-1.39-.223-2.73-.635-3.985a.75.75 0 00-.722-.515 11.209 11.209 0 01-7.877-3.08z" clip-rule="evenodd" />
                    </svg>
                    <h4>Roles & Permissions</h4>
                </div>
                <div class="card-content">
                    @if (userProfile.Roles != null && userProfile.Roles.Any())
                    {
                        <div class="roles-container">
                            @foreach (var role in userProfile.Roles)
                            {
                                <span class="role-badge">@role</span>
                            }
                        </div>
                    }
                    else
                    {
                        <span class="detail-value text-muted">No roles assigned</span>
                    }
                </div>
            </div>
        </div>
    </div>
}
else
{
    <div class="no-data-container">
        <p>No user details available.</p>
        <button @onclick="RefreshData" class="retry-button">Refresh</button>
    </div>
}