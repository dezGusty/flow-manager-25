@using Microsoft.AspNetCore.Authorization
@using FlowManager.Client.ViewModels
@attribute [Authorize(Roles = "Admin")]

<PageTitle>Departments</PageTitle>

<h2 class="page-title">Departments</h2>

<div class="departments-grid">
    @if (departments == null || !departments.Any())
    {
        <p>No departments available.</p>
    }
    else
    {
        @foreach (var department in departments)
        {
            <div class="department-card" @onclick="() => OpenModal(department)">
                <span class="department-name">@department.Name</span>

            </div>
        }
    }
</div>

@if (isModalOpen && selectedDepartment != null)
{
    <div class="modal-backdrop" @onclick="CloseModal">
        <div class="modal-content" @onclick:stopPropagation="true">

            <div class="modal-header">
                <h3>@selectedDepartment.Name</h3>
                <button class="close-icon" @onclick="CloseModal">✕</button>
            </div>

            @if (selectedDepartment.Teams != null && selectedDepartment.Teams.Any())
            {
                <div class="modal-section">
                    <h4>Teams</h4>
                    <ul>
                        @foreach (var team in selectedDepartment.Teams)
                        {
                            <li>@team.Name</li>
                        }
                    </ul>
                </div>
            }

            @if (selectedDepartment.Users != null && selectedDepartment.Users.Any())
            {
                <div class="modal-section">
                    <h4>Users</h4>
                    <ul>
                        @foreach (var user in selectedDepartment.Users)
                        {
                            <li>@user.Name (@user.Email)</li>
                        }
                    </ul>
                </div>
            }
        </div>
    </div>
}